<!-- [x] Jobs & Placements that are still pending approval -->
<div th:fragment="pending-approval" id="pending-approval" xmlns:th="http://www.thymeleaf.org">

    <div class="row">
        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
            <h1 class="table-heading">Pending Approval</h1>
        </div>
        <div class="col-12 col-md-7 col-lg-8 col-xl-6">
            <input class="form-control" id="filterPendingApproval" type="text" name="keyword"
                placeholder="Filter Positions..." />
        </div>
        <div class="col-md-1 col-xl-3"></div>
    </div>

    <div class="row table-container">
        <table class="table table-sm table-danger table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Provider</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Description</th>
                    <th class="text-center">Manage</th>
                </tr>
            </thead>
            <tbody id="pendingApprovalData">
                <tr th:each="pos : ${pendingPositions}">
                    <th scope="row" th:text="${pos.id}"></th>
                    <td th:text="${pos.type}">Job</td>
                    <td th:text="${pos.partner.businessName}">Microsoft</td>
                    <td th:text="${#dates.format(pos.startDate, 'dd/MM/yyyy')}">1/12/2022</td>
                    <td th:text="${#dates.format(pos.endDate, 'dd/MM/yyyy')}">24/12/2022</td>
                    <td th:text="${pos.description}">Just a one month job</td>
                    <td style="display: flex;">
                        <div class="mx-auto">
                            <span class="material-symbols-rounded btn-approve">Done</span>
                            <span class="material-symbols-rounded btn-edit" title="Edit">Edit</span>
                            <span class="material-symbols-rounded btn-delete">Delete</span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <script th:inline="javascript">
            /*<![CDATA[*/
            var data =
                /*[[${pendingPositions}]]*/
                /*]]>*/
                $("#filterPendingApproval").on("keyup", function () {

                    var value = $(this).val();

                    let filteredData = [];
                    for (let i = 0; i < data.length; i++) {
                        value = value.toLowerCase();
                        let id = data[i].id;
                        let type = data[i].type.toLowerCase();
                        let provider = data[i].partner.businessName.toLowerCase();
                        let startDate = formatDate(data[i].startDate);
                        let endDate = formatDate(data[i].endDate);
                        let description = data[i].description;

                        if (id == value || type.includes(value) || provider.includes(value) ||
                            startDate.includes(value) || endDate.includes(value) || description.includes(value)) {
                            filteredData.push(data[i]);
                        }
                    }

                    var table = document.getElementById("pendingApprovalData");
                    table.innerHTML = ``;
                    for (let i = 0; i < filteredData.length; i++) {
                        let row = `<tr>
                                        <th scope="row">${filteredData[i].id}</th>
                                        <td>${filteredData[i].type}</td>
                                        <td>${filteredData[i].partner.businessName}</td>
                                        <td>${formatDate(filteredData[i].startDate)}</td>
                                        <td>${formatDate(filteredData[i].endDate)}</td>
                                        <td>${filteredData[i].description}</td>
                                        <td style="display: flex;">
                                            <div class="mx-auto">
                                                <span class="material-symbols-rounded btn-approve">Done</span>
                                                <span class="material-symbols-rounded btn-edit" title="Edit">Edit</span>
                                                <span class="material-symbols-rounded btn-delete">Delete</span>
                                            </div>
                                        </td>
                                        </tr>`;
                        table.innerHTML += row;
                    }
                });
        </script>
    </div>
    <hr />

</div>


<!-- Current (approved) Jobs & Placements -->
<div th:fragment="approved" id="approved" xmlns:th="http://www.thymeleaf.org">

    <div class="row">
        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
            <h1 class="table-heading">Current</h1>
        </div>
        <div class="col-12 col-md-7 col-lg-8 col-xl-6">
            <input class="form-control" id="approvedFilter" type="text" name="keyword" placeholder="Filter Positions..." /></div>
        <div class="col-md-1 col-xl-3"></div>
    </div>

    <div class="row table-container">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Provider</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Description</th>
                    <th class="text-center">Manage</th>
                </tr>
            </thead>
            <tbody id="approvedPositionsData">
                <tr th:each="pos : ${approvedPositions}">
                    <th scope="row" th:text="${pos.id}"></th>
                    <td th:text="${pos.type}">Job</td>
                    <td th:text="${pos.partner.businessName}">Microsoft</td>
                    <td th:text="${#dates.format(pos.startDate, 'dd/MM/yyyy')}">1/12/2022</td>
                    <td th:text="${#dates.format(pos.endDate, 'dd/MM/yyyy')}">24/12/2022</td>
                    <td th:text="${pos.description}">Just a one month job</td>
                    <td style="display: flex;">
                        <div class="mx-auto">
                            <span class="material-symbols-rounded btn-edit" title="Edit">edit</span>
                            <span class="material-symbols-rounded btn-delete">delete</span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <script th:inline="javascript">
            /*<![CDATA[*/
            var positions =
                /*[[${approvedPositions}]]*/
                /*]]>*/
                $("#approvedFilter").on("keyup", function () {
                    var value = $(this).val();
                    var table = document.getElementById("approvedPositionsData");
                    var filteredData = educatorFilterPositions(value, positions);
                    rebuildEducatorPositionsTable(filteredData, table);
                });
        </script>
    </div>

</div>


<!-- [x] current (approved) jobs & placements for students-->
<div th:fragment="approvedStudent" id="approvedStudent" xmlns:th="http://www.thymeleaf.org">

    <div class="row">
        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
            <h1 class="table-heading">Current</h1>
        </div>
        <div class="col-12 col-md-7 col-lg-8 col-xl-6">
            <input class="form-control" id="filterApprovedStudent" type="text" name="keyword"
                placeholder="Filter Positions..." />
        </div>
        <div class="col-md-1 col-xl-3"></div>
    </div>

    <div class="row table-container">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Provider</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Description</th>
                    <th class="text-center">View Job & Placement Details</th>
                </tr>
            </thead>
            <tbody id="approvedStudentData">
                <tr th:each="pos : ${allPositions}">
                    <th scope="row" th:text="${pos.id}"></th>
                    <td th:text="${pos.type}">Job</td>
                    <td th:text="${pos.partner.businessName}">Microsoft</td>
                    <td th:text="${#dates.format(pos.startDate, 'dd/MM/yyyy')}">1/12/2022</td>
                    <td th:text="${#dates.format(pos.endDate, 'dd/MM/yyyy')}">24/12/2022</td>
                    <td th:text="${pos.description}">Just a one month job</td>
                    <td style="display: flex;">
                        <div class="mx-auto">
                            <!-- Pass the position type and id in the link so the details can be displayed -->
                            <a th:if="${#strings.toLowerCase(pos.type) == 'placement'}" class='btn btn-primary'
                                th:href="@{marketplace-details?type=placement&id={posId} (posId=${pos.id})}">View
                                Placement</a>
                            <a th:if="${#strings.toLowerCase(pos.type) == 'job'}" class='btn btn-primary'
                                th:href="@{marketplace-details?type=job&id={posId} (posId=${pos.id})}">View Job</a>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <script th:inline="javascript">
            /*<![CDATA[*/
            var approvedStudentDataList =
                /*[[${allPositions}]]*/
                /*]]>*/
            $("#filterApprovedStudent").on("keyup", function () {

                var value = $(this).val();

                let filteredData = [];
                for (let i = 0; i < approvedStudentDataList.length; i++) {
                    value = value.toLowerCase();
                    let id = approvedStudentDataList[i].id;
                    let type = approvedStudentDataList[i].type.toLowerCase();
                    let partner = approvedStudentDataList[i].partner.businessName.toLowerCase();
                    let startDate = formatDate(approvedStudentDataList[i].startDate);
                    let endDate = formatDate(approvedStudentDataList[i].endDate);
                    let description = approvedStudentDataList[i].description.toLowerCase();

                    if (id == value || type.includes(value) || partner.includes(value) ||
                        startDate.includes(value) || endDate.includes(value) || description.includes(value)) {
                        filteredData.push(approvedStudentDataList[i]);
                    }
                }

                var table = document.getElementById("approvedStudentData");
                table.innerHTML = ``;
                for (let i = 0; i < filteredData.length; i++) {
                    let row = `<tr>
                    <th scope="row">${filteredData[i].id}</th>
                    <td>${filteredData[i].type}</td>
                    <td>${filteredData[i].partner.businessName}</td>
                    <td>${formatDate(filteredData[i].startDate)}</td>
                    <td>${formatDate(filteredData[i].endDate)}</td>
                    <td>${filteredData[i].description}</td>
                    <td style="display: flex;">
                        <div class="mx-auto">
                            <!-- Pass the position type and id in the link so the details can be displayed -->
                            ${
                                filteredData[i].type.toLowerCase() == 'placement'? 
                                `<a class="btn btn-primary" href="/student/marketplace-details?type=placement&id=${filteredData[i].id}">View Placement</a>` :
                                `<a class="btn btn-primary" href="/student/marketplace-details?type=job&id=${filteredData[i].id}" > View Job</a >`
                            }
                            
                        </div>
                    </td>
                    </tr>`;
                    table.innerHTML += row;
                }
            });
        </script>
    </div>

</div>


<!-- [x] Partner Jobs & Placements -->
<!-- Fix JavaScript button creation (see approvedStudent fragment) -->
<div th:fragment="partner" id="partner" xmlns:th="http://www.thymeleaf.org">

    <div class="row">
        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
            <h1 class="table-heading">Your Jobs & Placements</h1>
        </div>
        <div class="col-12 col-md-7 col-lg-8 col-xl-6">
            <input class="form-control" id="filterPartner" type="text" name="keyword"
                placeholder="Filter Positions..." />
        </div>
        <div class="col-md-1 col-xl-3"></div>
    </div>

    <div class="row table-container">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th class="text-center">Manage</th>
                </tr>
            </thead>
            <tbody id="partnerDataList">
                <tr th:each="pos : ${partnerPositions}">
                    <th scope="row" th:text="${pos.id}"></th>
                    <td th:text="${pos.type}">Job</td>
                    <td th:text="${#dates.format(pos.startDate, 'dd/MM/yyyy')}">1/12/2022</td>
                    <td th:text="${#dates.format(pos.endDate, 'dd/MM/yyyy')}">24/12/2022</td>
                    <td th:text="${pos.description}">Just a one month job</td>
                    <td th:text="${pos.approved ? 'Approved' : 'Pending'}">Approved</td>
                    <td style="display: flex;">
                        <div class="mx-auto">
                            <!-- link passes position type as a request param to dynamically load the edit page -->
                            <a th:href="@{'/partner/edit-position?type=' + ${pos.type}}"
                                class="material-symbols-rounded btn-edit" title="Edit">edit</a>
                            <span class="material-symbols-rounded btn-delete">delete</span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <script th:inline="javascript">
            /*<![CDATA[*/
            var partnerDataList =
                /*[[${partnerPositions}]]*/
                /*]]>*/
                $("#filterPartner").on("keyup", function () {

                    var value = $(this).val();

                    let filteredData = [];
                    for (let i = 0; i < partnerDataList.length; i++) {
                        value = value.toLowerCase();
                        let id = partnerDataList[i].id;
                        let type = partnerDataList[i].type.toLowerCase();
                        let startDate = formatDate(partnerDataList[i].startDate);
                        let endDate = formatDate(partnerDataList[i].endDate);
                        let description = partnerDataList[i].description.toLowerCase();

                        if (id == value || type.includes(value) ||
                            startDate.includes(value) || endDate.includes(value) || description.includes(value)) {
                            filteredData.push(partnerDataList[i]);
                        }
                    }

                    var table = document.getElementById("partnerDataList");
                    table.innerHTML = ``;
                    for (let i = 0; i < filteredData.length; i++) {
                        let row = `<tr>
                                <th scope="row">${filteredData[i].id}</th>
                                <td>${filteredData[i].type}</td>
                                <td>${formatDate(filteredData[i].startDate)}</td>
                                <td>${formatDate(filteredData[i].endDate)}</td>
                                <td>${filteredData[i].description}</td>
                                <td>${filteredData[i].approved ? 'Approved' : 'Pending'}</td>
                                <td style="display: flex;">
                                    <div class="mx-auto">
                                        ${`<a class="material-symbols-rounded btn-edit" href="/partner/edit-position?type=${filteredData[i].type}"><span class="material-symbols-rounded btn-edit" > edit</span></a>`}
                                        <span class="material-symbols-rounded btn-delete" > delete</span>
                                    </div>
                                </td>
                                </tr>`;
                        table.innerHTML += row;
                    }
                });
        </script>
    </div>

</div>


<!-- [x] Partner Jobs & Placements -->
<!-- Fix JavaScript button creation (see approvedStudent fragment) -->
<div th:fragment="partner-expression-of-interest" id="partner-expression-of-interest"
    xmlns:th="http://www.thymeleaf.org">

    <div class="row">
        <div class="col-12 col-md-4 col-lg-4 col-xl-3">
            <h1 class="table-heading">Pending Expressions of Interest</h1>
        </div>
        <div class="col-12 col-md-7 col-lg-8 col-xl-6">
            <input class="form-control" id="filterPartnerExpressionOfInterest" type="text" name="keyword"
                placeholder="Filter Positions..." />
        </div>
        <div class="col-md-1 col-xl-3"></div>
    </div>

    <div class="row table-container">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th class="text-center">Manage</th>
                </tr>
            </thead>
            <tbody id="partnerExpressionOfInterestData">
                <tr th:each="pos : ${partnerEOIPositions}">
                    <th scope="row" th:text="${pos.id}"></th>
                    <td th:text="${pos.type}">Job</td>
                    <td th:text="${#dates.format(pos.startDate, 'dd/MM/yyyy')}">1/12/2022</td>
                    <td th:text="${#dates.format(pos.endDate, 'dd/MM/yyyy')}">24/12/2022</td>
                    <td th:text="${pos.description}">Just a one month job</td>
                    <td th:text="${pos.approved ? 'Approved' : 'Pending'}">Approved</td>
                    <td style="display: flex;">
                        <div class="mx-auto">
                            <span class="material-symbols-rounded btn-edit" title="Edit">edit</span>
                            <span class="material-symbols-rounded btn-delete">delete</span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <script th:inline="javascript">
            /*<![CDATA[*/
            var eoiDataList =
                /*[[${approvedPositions}]]*/
                /*]]>*/
                $("#filterApproved").on("keyup", function () {

                    var value = $(this).val();

                    let filteredData = [];
                    for (let i = 0; i < eoiDataList.length; i++) {
                        value = value.toLowerCase();
                        let id = eoiDataList[i].id;
                        let type = eoiDataList[i].type.toLowerCase();
                        let startDate = formatDate(eoiDataList[i].startDate);
                        let endDate = formatDate(eoiDataList[i].endDate);
                        let description = eoiDataList[i].description.toLowerCase();

                        if (id == value || type.includes(value) ||
                            startDate.includes(value) || endDate.includes(value) || description.includes(value)) {
                            filteredData.push(eoiDataList[i]);
                        }
                    }

                    var table = document.getElementById("approvedData");
                    table.innerHTML = ``;
                    for (let i = 0; i < filteredData.length; i++) {
                        let row = `<tr>
                                <th scope="row">${filteredData[i].id}</th>
                                <td>${filteredData[i].type}</td>
                                <td>${formatDate(filteredData[i].startDate)}</td>
                                <td>${formatDate(filteredData[i].endDate)}</td>
                                <td>${filteredData[i].description}</td>
                                <td>${filteredData[i].approved}</td>
                                <td style="display: flex;">
                                    <div class="mx-auto">
                                        ${`<a class="material-symbols-rounded btn-edit" href="/partner/edit-position?type=${filteredData[i].type}"><span class="material-symbols-rounded btn-edit" > edit</span></a>`}
                                        <span class="material-symbols-rounded btn-delete" > delete</span>
                                    </div>
                                </td>
                                </tr>`;
                        table.innerHTML += row;
                    }
                });
        </script>
    </div>
</div>